name: Generate Stats Badges

on:
  schedule:
    - cron: '0 0 * * *'  # Ù‡Ø± Ø±ÙˆØ² Ø³Ø§Ø¹Øª 00:00
  workflow_dispatch:

jobs:
  badges:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Get views
        id: views
        uses: octokit/request-action@v2
        with:
          route: GET /repos/${{ github.repository }}/traffic/views
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Get clones
        id: clones
        uses: octokit/request-action@v2
        with:
          route: GET /repos/${{ github.repository }}/traffic/clones
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create badges
        run: |
          mkdir -p docs/badges
          views=$(jq '.count' <<< "${{ steps.views.outputs.data }}")
          clones=$(jq '.count' <<< "${{ steps.clones.outputs.data }}")
          
          echo "<svg xmlns='http://www.w3.org/2000/svg' width='150' height='20'><rect width='150' height='20' fill='#555'/><text x='75' y='14' fill='#fff' font-family='Verdana' font-size='11' text-anchor='middle'>ðŸ‘€ Views: $views</text></svg>" > docs/badges/views.svg

          echo "<svg xmlns='http://www.w3.org/2000/svg' width='150' height='20'><rect width='150' height='20' fill='#555'/><text x='75' y='14' fill='#fff' font-family='Verdana' font-size='11' text-anchor='middle'>ðŸ“¥ Clones: $clones</text></svg>" > docs/badges/clones.svg

      - name: Commit & push badges
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add docs/badges/*.svg
          git commit -m "Update stats badges"
          git push
