name: Update Repository Stats in README
on:
  schedule:
    - cron: '0 0 * * *'  # Ø§Ø¬Ø±Ø§ Ù‡Ø± Ø±ÙˆØ² Ø³Ø§Ø¹Øª 00:00 (ØªØµØ­ÛŒØ­ Ø´Ø¯)
  workflow_dispatch:      # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4  # Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯ØªØ±
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Get repository stats
        id: stats
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          REPO="${{ github.repository }}"
          
          # ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ÙˆÙ†â€ŒÙ‡Ø§ (Ø¢Ø®Ø±ÛŒÙ† 14 Ø±ÙˆØ²)
          CLONES=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/repos/$REPO/traffic/clones" | jq '.count // 0')
          
          # ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²Ø¯ÛŒØ¯Ù‡Ø§ (Ø¢Ø®Ø±ÛŒÙ† 14 Ø±ÙˆØ²)
          VIEWS=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/repos/$REPO/traffic/views" | jq '.count // 0')
          
          # ØªØ¹Ø¯Ø§Ø¯ Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§
          STARS=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/repos/$REPO" | jq '.stargazers_count // 0')
          
          # ØªØ¹Ø¯Ø§Ø¯ ÙÙˆØ±Ú©â€ŒÙ‡Ø§
          FORKS=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/repos/$REPO" | jq '.forks_count // 0')
          
          # ØªØ¹Ø¯Ø§Ø¯ Ø§ÛŒØ´ÙˆÙ‡Ø§
          ISSUES=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/repos/$REPO" | jq '.open_issues_count // 0')
          
          # ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
          UPDATED=$(date '+%Y-%m-%d %H:%M:%S')
          
          # ØªÙ†Ø¸ÛŒÙ… Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
          echo "clones=$CLONES" >> $GITHUB_OUTPUT
          echo "views=$VIEWS" >> $GITHUB_OUTPUT
          echo "stars=$STARS" >> $GITHUB_OUTPUT
          echo "forks=$FORKS" >> $GITHUB_OUTPUT
          echo "issues=$ISSUES" >> $GITHUB_OUTPUT
          echo "updated=$UPDATED" >> $GITHUB_OUTPUT

      - name: Update README
        run: |
          # Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø®Ø´ Ø¢Ù…Ø§Ø± Ø¬Ø¯ÛŒØ¯
          cat > stats_section.md << 'EOF'
          ## ðŸ“Š Repository Stats
          
          | Ø¢Ù…Ø§Ø± | ØªØ¹Ø¯Ø§Ø¯ |
          |------|--------|
          | â­ Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§ | ${{ steps.stats.outputs.stars }} |
          | ðŸ´ ÙÙˆØ±Ú©â€ŒÙ‡Ø§ | ${{ steps.stats.outputs.forks }} |
          | ðŸ‘€ Ø¨Ø§Ø²Ø¯ÛŒØ¯Ù‡Ø§ (14 Ø±ÙˆØ² Ø§Ø®ÛŒØ±) | ${{ steps.stats.outputs.views }} |
          | ðŸ“¥ Ú©Ù„ÙˆÙ†â€ŒÙ‡Ø§ (14 Ø±ÙˆØ² Ø§Ø®ÛŒØ±) | ${{ steps.stats.outputs.clones }} |
          | ðŸ› Ø§ÛŒØ´ÙˆÙ‡Ø§ÛŒ Ø¨Ø§Ø² | ${{ steps.stats.outputs.issues }} |
          
          *Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${{ steps.stats.outputs.updated }}*
          
          EOF
          
          # Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
          cat > project_content.md << 'EOF'
          # File Naming Enforcer
          A Visual Studio Code extension that automatically enforces file and folder naming conventions based on project-specific rules or predefined presets for popular frameworks like **React** and **Laravel**.
          
          ## âœ¨ Features
          - **ðŸ”„ Automatic Naming Enforcement**: Detects newly created files or folders and renames them according to your defined rules
          - **âš™ï¸ Configurable Rules**: Define custom naming rules in a `file-naming.config.json` file at the root of your project
          - **ðŸ“¦ Framework Presets**: Built-in presets for popular frameworks:
            - **React**: PascalCase for components, camelCase for hooks, kebab-case for CSS files
            - **Laravel**: PascalCase for models/controllers, snake_case for blade templates, camelCase/kebab-case for JS/CSS
          - **ðŸŽ¯ Flexible Rename Modes**:
            - **Auto**: Automatically rename files/folders
            - **Ask**: Prompt the user before renaming
          
          ## ðŸš€ Usage
          ### 1. Configuration Setup
          Create a `file-naming.config.json` file at the root of your project:
          ```json
          {
            "preset": "react",
            "rules": {
              "src/utils/*.ts": "camelCase",
              "components/**/*.tsx": "PascalCase",
              "styles/**/*.css": "kebab-case"
            },
            "rename": "ask"
          }
          ```
          
          **Configuration Options:**
          - `preset` (optional): Use `"react"` or `"laravel"` for predefined rules
          - `rules` (optional): Custom glob patterns and their naming conventions
          - `rename`: `"auto"` or `"ask"` (default: `"ask"`)
          
          ### 2. How It Works
          When a new file or folder is created, the extension will:
          1. Check if the name follows the configured rules
          2. If it doesn't comply:
             - **Auto mode**: Automatically rename the file/folder
             - **Ask mode**: Prompt you before renaming
          
          ## ðŸ“ Naming Conventions
          | Convention     | Description                                           | Example                  |
          | -------------- | ----------------------------------------------------- | ------------------------ |
          | **PascalCase** | Each word starts with a capital letter, no separators | `MyFileName.tsx`         |
          | **camelCase**  | Like PascalCase, but first letter is lowercase        | `myFileName.ts`          |
          | **kebab-case** | Lowercase words separated by hyphens                  | `my-file-name.css`       |
          | **snake_case** | Lowercase words separated by underscores              | `my_file_name.blade.php` |
          
          ## ðŸŽ¯ Framework Presets
          ### React Preset
          ```json
          {
            "preset": "react",
            "rules": {},
          }
          ```
          - Components: PascalCase (`Button.tsx`, `UserProfile.tsx`)
          - Hooks: camelCase (`useFetch.ts`, `useAuth.ts`)
          - Styles: kebab-case (`main.css`, `user-profile.css`)
          - Utils: camelCase (`helpers.ts`, `apiUtils.ts`)
          
          ### Laravel Preset
          ```json
          {
            "preset": "laravel",
            "rules": {},
          }
          ```
          - Models/Controllers: PascalCase (`User.php`, `UserController.php`)
          - Blade templates: snake_case (`user_profile.blade.php`)
          - JavaScript: camelCase (`userUtils.js`)
          - CSS: kebab-case (`user-styles.css`)
          
          ## ðŸ’¡ Example Usage
          **Configuration:**
          ```json
          {
            "preset": "react",
            "rules": {},
            "rename": "auto"
          }
          ```
          
          **Automatic Renaming Behavior:**
          - `components/button/index.tsx` â†’ `components/Button/index.tsx`
          - `hooks/useFetch.ts` â†’ `hooks/useFetch.ts` âœ“ (already correct)
          - `styles/mainStyle.css` â†’ `styles/main-style.css`
          - `utils/apihelper.ts` â†’ `utils/apiHelper.ts`
          
          ## ðŸ› ï¸ Development
          ### Contributing
          1. **Fork** the repository
          2. **Create** a feature branch: `git checkout -b feature-name`
          3. **Commit** your changes: `git commit -m "Add feature"`
          4. **Push** to the branch: `git push origin feature-name`
          5. **Open** a pull request
          
          ### Local Development
          1. Clone the repository
          2. Run `npm install` to install dependencies
          3. Open in VS Code
          4. Press `F5` to launch the extension in development mode
          
          ## ðŸ“„ License
          MIT License
          
          ## ðŸ¤ Support
          **Made with â¤ï¸ for developers who care about consistent code organization**
          
          EOF
          
          # Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„ README
          if [ -f README.md ]; then
            # Ø­Ø°Ù Ø¨Ø®Ø´ Ù‚Ø¨Ù„ÛŒ Ø¢Ù…Ø§Ø± (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯)
            sed -i '/## ðŸ“Š Repository Stats/,/^\*Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:/d' README.md
            
            # Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù…Ø­ØªÙˆØ§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡
            if ! grep -q "# File Naming Enforcer" README.md; then
              # Ø§Ú¯Ø± Ù…Ø­ØªÙˆØ§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§Ø¨ØªØ¯Ø§ Ø¢Ù† Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
              cat project_content.md README.md > temp_readme.md
              mv temp_readme.md README.md
            fi
            
            # Ø­Ø§Ù„Ø§ Ø¢Ù…Ø§Ø± Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
            cat stats_section.md README.md > temp_readme.md
            mv temp_readme.md README.md
          else
            # Ø§Ú¯Ø± README ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ø¨Ø§ Ù…Ø­ØªÙˆØ§ÛŒ Ú©Ø§Ù…Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†
            cat project_content.md > README.md
            cat stats_section.md >> README.md
          fi
          
          # Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙ‚Øª
          rm -f stats_section.md project_content.md

      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # Ø¨Ø±Ø±Ø³ÛŒ ØªØºÛŒÛŒØ±Ø§Øª
          if [ -n "$(git status --porcelain)" ]; then
            git add README.md
            git commit -m "ðŸ“Š Update repository stats - $(date '+%Y-%m-%d')"
            git push
            echo "âœ… README updated successfully!"
          else
            echo "â„¹ï¸ No changes detected in README"
          fi

      - name: Summary
        run: |
          echo "## ðŸ“Š Stats Update Summary" >> $GITHUB_STEP_SUMMARY
          echo "- â­ Stars: ${{ steps.stats.outputs.stars }}" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ´ Forks: ${{ steps.stats.outputs.forks }}" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ‘€ Views: ${{ steps.stats.outputs.views }}" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ“¥ Clones: ${{ steps.stats.outputs.clones }}" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ› Open Issues: ${{ steps.stats.outputs.issues }}" >> $GITHUB_STEP_SUMMARY
